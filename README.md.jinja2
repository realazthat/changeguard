<!--
{% set project_name='changeguard' %}
{% set project_name_proper='ChangeGuard' %}
{% set last_unstable_release=shell('tomlq -r -e \'.["tool"]["changeguard-project-metadata"]["last_unstable_release"]\' pyproject.toml',
                                   include_args=False) | trim %}
{% set last_stable_release=shell('tomlq -r -e \'.["tool"]["changeguard-project-metadata"]["last_stable_release"]\' pyproject.toml',
                                 include_args=False) | trim %}
{% set tested_python_versions=shell('python -m yq -r -c \'[.jobs["build-and-test"]["strategy"]["matrix"]["python-version"][].gh] | join(", ")\' .github/workflows/build-and-test.yml',
                                 include_args=False) | trim %}
{% set badge_color='0A1E1E' %}
-->

# <div align="center">[![{{project_name_proper}}][1]][2]</div>

<div align="center">

<!-- Icons from https://lucide.dev/icons/users -->
<!-- Icons from https://lucide.dev/icons/laptop-minimal -->

![**Audience:** Developers][3] ![**Platform:** Linux][4]

</div>

<p align="center">
  <strong>
    <a href="https://github.com/realazthat/{{project_name}}">üè†Home</a>
    &nbsp;&bull;&nbsp;
    <a href="#-features">üéáFeatures</a>
    &nbsp;&bull;&nbsp;
    <a href="#-install">üî®Install</a>
    &nbsp;&bull;&nbsp;
    <a href="#-requirements">‚úÖRequirements</a>
  </strong>
</p>

<p align="center">
  <strong>
    <a href="#-usage">üöúUsage</a>
    &nbsp;&bull;&nbsp;
    <a href="#-command-line-options">üíªCLI</a>
    &nbsp;&bull;&nbsp;
    <a href="#-docker-image">üê≥Docker</a>
  </strong>
</p>

<div align="center">

![Top language][5] ![GitHub License][6] [![PyPI - Version][7]][8]
[![Python Version][9]][8]

**CLI to check if your repository/directory files have changed over the span of
a script.**

</div>

---

<div align="center">

|               | Status                      | Stable                    | Unstable                  |                          |
| ------------- | --------------------------- | ------------------------- | ------------------------- | ------------------------ |
| [Master][10]  | [![Build and Test][11]][12] | [![since tagged][13]][14] |                           | [![last commit][15]][16] |
| [Develop][17] | [![Build and Test][18]][12] | [![since tagged][19]][20] | [![since tagged][21]][22] | [![last commit][23]][24] |

</div>

## ‚ùî What

Like hashdeep, but customized to check if any of the original files in a
repository/directory change over the course of a precommit script.

## üéá Features

- Can use any sha256sum-like command (uses xxhash by default).
- Use `.changeguard-ignore` to ignore files that should not be checked for
  changes.

## üî® Install

```bash
# Install from pypi (https://pypi.org/project/{{project_name}}/)
pip install {{project_name}}

# Install from git (https://github.com/realazthat/{{project_name}})
pip install git+https://github.com/realazthat/{{project_name}}.git@v{{last_stable_release}}
```

## üöú Usage

<!--{{snippet('./changeguard/examples/hash-audit_example.sh',
              start='# SNIPPET_START',
              end='\n# SNIPPET_END',
              backtickify='bash',
              decomentify='nl')|trim}}-->

## üíª Command Line Options

<!--{{ shell('python -m changeguard.cli --help',
             rich='README.help.generated.svg',
             rich_alt='Output of `python -m changeguard.cli --help`',
             rich_bg_color='black',
             rich_term='xterm-256color',
             rich_cols=160,
             decomentify='nl') }}-->

## ‚úÖ Requirements

- Python 3.8+
  - Why: Some dev dependencies require Python 3.8+.

### Tested on

- WSL2 Ubuntu 20.04, Python `{{rawsnippet('./.python-version') | trim}}`.
- Ubuntu 20.04, Python `{{tested_python_versions}}`, tested in GitHub Actions
  workflow ([build-and-test.yml](./.github/workflows/build-and-test.yml)).

## üê≥ Docker Image

Docker images are published to [ghcr.io/realazthat/{{project_name}}][48] at each
tag.

```bash
# Use the published images at ghcr.io/realazthat/{{project_name}}.
docker run --rm -it ghcr.io/realazthat/{{project_name}}:v{{last_stable_release}} --help

# /data in the docker image is the working directory, so paths are simpler.
docker run --rm -it \
  -v $(pwd):/data \
  ghcr.io/realazthat/{{project_name}}:v{{last_stable_release}} \
  hash \
  --ignorefile "${PROJ_PATH}/.gitignore" \
  --ignoreline .trunk --ignoreline .git \
  --method "${METHOD}" \
  --tmp-backup-dir "${PWD}/.cache/scripts/audit-original" \
  --audit-file "${AUDIT_FILE}" \
  --directory "${PROJ_PATH}"

docker run --rm -it \
  -v $(pwd):/data \
  ghcr.io/realazthat/{{project_name}}:v{{last_stable_release}} \
  audit \
  --audit-file "${AUDIT_FILE}" \
  --show-delta \
  --directory "${PROJ_PATH}"
```

If you want to build the image yourself, you can use the Dockerfile in the
repository.

<!--{{snippet('./changeguard/examples/local-docker_example.sh',
              start='# SNIPPET_START',
              end='\n# SNIPPET_END',
              backtickify='bash',
              decomentify='nl')|trim}}-->

## ü§è Versioning

We use SemVer for versioning. For the versions available, see the tags on this
repository.

## üîë License

This project is licensed under the MIT License - see the
{{path('./LICENSE.md', link='md')}} file for details.

## üôè Thanks

Main libraries used in {{project_name_proper}} are:

- Colorful CLI help: [rich-argparse](https://github.com/hamdanal/rich-argparse).
- pathspec, for gitignore support:
  [pathspec](https://github.com/cpburnz/python-pathspec).

## ü´° Contributions

### Development environment: Linux-like

- For running `pre.sh` (Linux-like environment).

  - From {{path('./.github/dependencies.yml', link='md')}}, which is used for
    the GH Action to do a fresh install of everything:

    {{shell('python -m yq --yaml-output  \'.dev\' .github/dependencies.yml',
    include_args=False,
    backtickify='yaml',
    indented=4
    )}}

  - Requires `pyenv`, or an exact matching version of python as in
    [`{{path('.python-version')}}`](./.python-version).
  - `nvm` for prettier (markdown formatting).
  - `act` (to run the GH Action locally):
    - Requires `nodejs`.
    - Requires `Go`.
    - `docker`.
  - Generate animation:
    - `docker`.
  - docker (for building the docker image).

### Commit Process

1. (Optionally) Fork the `develop` branch.
2. Stage your files: `git add path/to/file.py`.
3. `bash scripts/pre.sh`, this will format, lint, and test the code.
4. `git status` check if anything changed (generated `{{path('README.md')}}` for
   example), if so, `git add` the changes, and go back to the previous step.
5. `git commit -m "..."`.
6. Make a PR to `develop` (or push to develop if you have the rights).

## üîÑüöÄ Release Process

These instructions are for maintainers of the project.

1. In the `develop` branch, run `bash {{path('scripts/pre.sh')}}` to ensure
   everything is in order.
2. In the `develop` branch, bump the version in `{{path('pyproject.toml')}}`,
   following semantic versioning principles. Also modify the
   `last_unstable_release` and `last_stable_release` in the
   `[tool.{{project_name}}-project-metadata]` table as appropriate.
3. In the `develop` branch, commit these changes with a message like "Prepare
   release X.Y.Z". (See the contributions section [above](#commit-process)).
4. Merge the `develop` branch into the `master` branch:
   `git checkout master && git merge develop --no-ff`.
5. `master` branch: Tag the release: Create a git tag for the release with
   `git tag -a vX.Y.Z -m "Version X.Y.Z"`.
6. Publish to PyPI: Publish the release to PyPI with
   `bash scripts/deploy-to-pypi.sh`.
7. Push to GitHub: Push the commit and tags to GitHub with
   `git push && git push --tags`.
8. The `--no-ff` option adds a commit to the master branch for the merge, so
   refork the develop branch from the master branch:
   `git checkout develop && git merge master`.
9. Push the develop branch to GitHub: `git push origin develop`.

[1]: ./.github/logo-exported.svg
[2]: https://github.com/realazthat/{{project_name}}
[3]:
  https://img.shields.io/badge/Audience-Developers-{{badge_color}}?style=plastic&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLXVzZXJzIj48cGF0aCBkPSJNMTYgMjF2LTJhNCA0IDAgMCAwLTQtNEg2YTQgNCAwIDAgMC00IDR2MiIvPjxjaXJjbGUgY3g9IjkiIGN5PSI3IiByPSI0Ii8+PHBhdGggZD0iTTIyIDIxdi0yYTQgNCAwIDAgMC0zLTMuODciLz48cGF0aCBkPSJNMTYgMy4xM2E0IDQgMCAwIDEgMCA3Ljc1Ii8+PC9zdmc+
[4]:
  https://img.shields.io/badge/Platform-Linux-{{badge_color}}?style=plastic&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWxhcHRvcC1taW5pbWFsIj48cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTIiIHg9IjMiIHk9IjQiIHJ4PSIyIiByeT0iMiIvPjxsaW5lIHgxPSIyIiB4Mj0iMjIiIHkxPSIyMCIgeTI9IjIwIi8+PC9zdmc+
[5]:
  https://img.shields.io/github/languages/top/realazthat/{{project_name}}.svg?cacheSeconds=28800&style=plastic&color={{badge_color}}
[6]:
  https://img.shields.io/github/license/realazthat/{{project_name}}?style=plastic&color={{badge_color}}
[7]:
  https://img.shields.io/pypi/v/{{project_name}}?style=plastic&color={{badge_color}}
[8]: https://pypi.org/project/{{project_name}}/
[9]:
  https://img.shields.io/pypi/pyversions/{{project_name}}?style=plastic&color={{badge_color}}
[10]: https://github.com/realazthat/snipinator/tree/master
[11]:
  https://img.shields.io/github/actions/workflow/status/realazthat/{{project_name}}/build-and-test.yml?branch=master&style=plastic
[12]:
  https://github.com/realazthat/{{project_name}}/actions/workflows/build-and-test.yml
[13]:
  https://img.shields.io/github/commits-since/realazthat/{{project_name}}/v{{last_stable_release}}/master?style=plastic
[14]:
  https://github.com/realazthat/{{project_name}}/compare/v{{last_stable_release}}...master
[15]:
  https://img.shields.io/github/last-commit/realazthat/{{project_name}}/master?style=plastic
[16]: https://github.com/realazthat/snipinator/commits/master
[17]: https://github.com/realazthat/snipinator/tree/develop
[18]:
  https://img.shields.io/github/actions/workflow/status/realazthat/{{project_name}}/build-and-test.yml?branch=develop&style=plastic
[19]:
  https://img.shields.io/github/commits-since/realazthat/{{project_name}}/v{{last_stable_release}}/develop?style=plastic
[20]:
  https://github.com/realazthat/{{project_name}}/compare/v{{last_stable_release}}...develop
[21]:
  https://img.shields.io/github/commits-since/realazthat/{{project_name}}/v{{last_unstable_release}}/develop?style=plastic
[22]:
  https://github.com/realazthat/{{project_name}}/compare/v{{last_unstable_release}}...develop
[23]:
  https://img.shields.io/github/last-commit/realazthat/{{project_name}}/develop?style=plastic
[24]: https://github.com/realazthat/snipinator/commits/develop
